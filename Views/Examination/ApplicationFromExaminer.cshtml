@using Syncfusion.EJ2

@{
    ViewData["Title"] = "ApplicationFromExaminer";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}

<div class="container-fluid mt-3">
    <input hidden id="applicationId" value="@ViewBag.Application" />
    <!-- SmartWizard html -->
    <div id="smartwizard">

        <ul class="nav">
            <li class="nav-item">
                <a class="nav-link" href="#step-1">
                    <strong>Name details of the entity</strong>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#step-2" data-repo="smartwizard">
                    <strong>Registered office</strong>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#step-3" data-repo="jquery-smartcart">
                    <strong>Members, Directors and Secretary</strong>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#step-4" data-repo="jquery-smartcart">
                    <strong>Memorundum of association</strong>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#step-5" data-repo="jquery-smartcart">
                    <strong>Articles of association</strong>
                </a>
            </li>
        </ul>



        <div class="tab-content">

            <div id="step-1" class="tab-pane" role="tabpanel" aria-labelledby="step-1">
                <div class="card">
                    <div class="card-body">
                        <input type="hidden" name="billercode" value="@ViewBag.billercode" />
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Name of entity</label>
                                    @if (ViewBag.CompanyApplication.name != null)
                                    {
                        <input type="text" class="form-control" placeholder="Entity name" value="@ViewBag.CompanyApplication.name.Name" readonly> }
                    else
                    {
        <input type="text" class="form-control" placeholder="Entity name" value="" readonly>}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Type of entity</label>
                                    @if (ViewBag.CompanyApplication.name != null)
                                    {
                        <input type="text" class="form-control" placeholder="Type" value="@ViewBag.CompanyApplication.name.TypeOfEntity" readonly> }
                    else
                    {
        <input type="text" class="form-control" placeholder="Type" value="" readonly>}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Justification</label>
                                    "@if (ViewBag.CompanyApplication.name != null)
                                    {
                        <input type="text" class="form-control" placeholder="Justification" value="@ViewBag.CompanyApplication.name.Justification" readonly> }
                    else
                    {
        <input type="text" class="form-control" placeholder="Justification" value="" readonly>}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>





            <div id="step-2" class="tab-pane" role="tabpanel" aria-labelledby="step-2">
                <form id="officeForm" action="/Company/RegisterOffice" method="get">

                    <input type="hidden" id="ApplicationId" name="appicationId" />

                    <div class="card">
                        <div class="card-header">
                            <h4>Registered office details</h4>
                        </div>
                        <div class="card-body">

                            <input type="hidden" name="billercode" value="@ViewBag.billercode" />
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="#physicalAddress">Physical address</label>
                                        @if (ViewBag.CompanyApplication.office != null)
                                        {
                            <input type="text" id="physicalAddress" class="form-control" value="@ViewBag.CompanyApplication.office.PhysicalAddress" readonly> }
                        else
                        {
            <input type="text" id="physicalAddress" class="form-control" value="" readonly>}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="#postalAddress">Postal address</label>
                                        @if (ViewBag.CompanyApplication.office != null)
                                        {
                            <input type="text" class="form-control" id="postalAddress" value="@ViewBag.CompanyApplication.office.PostalAddress" readonly> }
                        else
                        {
            <input type="text" class="form-control" id="postalAddress" value="" readonly>}

                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="#city">City</label>
                                        @if (ViewBag.CompanyApplication.office != null)
                                        {
                            <input type="text" class="form-control" id="city" value="@ViewBag.CompanyApplication.office.City" readonly>}
                        else
                        {
            <input type="text" class="form-control" id="city" value="" readonly>}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="#emailAddress">Email address</label>
                                        @if (ViewBag.CompanyApplication.office != null)
                                        {
                            <input type="email" class="form-control" id="emailAddress" value="@ViewBag.CompanyApplication.office.EmailAddress" readonly>}
                        else
                        {
            <input type="text" class="form-control" id="emailAddress" value="" readonly>}
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="#telephone">Telephone number</label>
                                        @if (ViewBag.CompanyApplication.office != null)
                                        {
                            <input type="text" class="form-control" id="telephone" value="@ViewBag.CompanyApplication.office.TelephoneNumber" readonly>}
                        else
                        {
            <input type="text" class="form-control" id="telephone" value="" readonly>}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Mobile number</label>
                                        @if (ViewBag.CompanyApplication.office != null)
                                        {
                            <input type="text" class="form-control" id="mobileNumber" value="@ViewBag.CompanyApplication.office.MobileNumber" readonly>}
                        else
                        {
            <input type="text" class="form-control" id="mobileNumber" value="" readonly>}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>

                @*////////////////////////////STEP 2 QUERY STARTS HERE///////////////////////////////////////////*@
                <br />


                @if (ViewBag.Queries != null)
                {
    <div class="card">
        <div class="card-header">
            <label class="mt-3"><h4>Queries</h4></label>
            <span style="flex: 1 1 auto"></span>
        </div>
        <div class="card-body">

            <div class="tab-pane" id="updates">
                <div class="table-responsive">
                    <table class="table  table-mb table-hover" style="color:#0C2A46;">
                        <thead mt-5 mb-5 style="color:#0C2A46;">
                            <tr>
                                <th style="color:#0C2A46">Date</th>
                                <th style="color:#0C2A46">Comment</th>
                                <th style="color:#0C2A46">Status</th>
                                <th style="color:#0C2A46">Action</th>
                            </tr>
                        </thead>

                        @foreach (var queries in ViewBag.Queries)
                        {
                            if (queries.tableName == "Step2")
                            {@*//step 2 Query below*@
                                                    <tbody>
                                                    <td>@queries.dateCreated</td>
                                                    <td>@queries.comment</td>
                                                    <td>@queries.status</td>
                                                    <td><a class="btn btn-info" color="white">Resolve Query</a></td>
                                                    </tbody>}
                                            }

                    </table>
                </div>
            </div>
        </div>
    </div> }
else
{
<div>no queries</div>} @*show nothing*@
@*//////////////////////////QUERIS END HERE//////////////////////*@
</div>

@*//////////////////////////END OF STEP 2//////////////////////*@



<div id="step-3" class="tab-pane" role="tabpanel" aria-labelledby="step-3">
    <input type="hidden" name="billercode" value="@ViewBag.billercode" />

    <div class="card">
        <div class="card-header">
            <label class="mt-3">Members</label>
            <span style="flex: 1 1 auto"></span>
        </div>
        <div class="card-body">
            <div class="form-group">
                @if (ViewBag.CompanyApplication.members.Count > 0)
                {

    <label>People</label>
                    <table class="table  table-mb table-hover" style="color:#0C2A46;">
                        <thead mt-5 mb-5 style="color:#0C2A46;">
                            <tr>
                                <th style="color:#0C2A46">Name</th>
                                <th style="color:#0C2A46">Surname</th>
                                <th style="color:#0C2A46">National ID</th>
                                <th style="color:#0C2A46">Nationality</th>
                                <th style="color:#0C2A46">Physical Address</th>
                                <th style="color:#0C2A46">Role(s)</th>
                                <th style="color:#0C2A46">Ordinary shares</th>
                                <th style="color:#0C2A46">Preference shares</th>
                                <th style="color:#0C2A46">Total shares</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var member in ViewBag.CompanyApplication.members)
                            {
            @if (member.MemberType == "Person")
            {
<tr>
    <td style="color:#0C2A46">@member.Name</td>
    <td style="color:#0C2A46">@member.Surname</td>
    <td style="color:#0C2A46">@member.NationalId</td>
    <td style="color:#0C2A46">@member.Nationality</td>
    <td style="color:#0C2A46">@member.PhysicalAddress</td>
    @{ var roles = "";
        foreach (var role in member.Roles)
        {
            roles = roles + " " + role;
        } }
    <td style="color:#0C2A46">@roles</td>
    <td style="color:#0C2A46">@member.OrdinaryShares</td>
    <td style="color:#0C2A46">@member.PreferenceShares</td>
    <td style="color:#0C2A46">@member.NumberOfShares</td>
</tr>}}

                        </tbody>
                    </table>

                                    <label class="mt-5">Entities</label>
                                                    <table class="table  table-mb table-hover" style="color:#0C2A46;">
                                                        <thead mt-5 mb-5 style="color:#0C2A46;">
                                                            <tr>
                                                                <th style="color:#0C2A46">Name</th>
                                                                <th style="color:#0C2A46">Entity number</th>
                                                                <th style="color:#0C2A46">Nationality</th>
                                                                <th style="color:#0C2A46">Role(s)</th>
                                                                <th style="color:#0C2A46">Ordinary shares</th>
                                                                <th style="color:#0C2A46">Preference shares</th>
                                                                <th style="color:#0C2A46">Totals shares</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @foreach (var member in ViewBag.CompanyApplication.members)
                                                            {
                                            @if (member.MemberType == "Entity")
                                            {
                        <tr>
                            <td style="color:#0C2A46">@member.Name</td>
                            <td style="color:#0C2A46">@member.NationalId</td>
                            <td style="color:#0C2A46">@member.Nationality</td>
                            @{ var roles = "";
                                foreach (var role in member.Roles)
                                {
                                    roles = roles + " " + role;
                                } }
                            <td style="color:#0C2A46">@roles</td>
                            <td style="color:#0C2A46">@member.OrdinaryShares</td>
                            <td style="color:#0C2A46">@member.PreferenceShares</td>
                            <td style="color:#0C2A46">@member.NumberOfShares</td>
                        </tr>}}

                                                        </tbody>
                                                    </table>}
            </div>
        </div>
    </div>
    <input type="hidden" name="members" id="members" />
    <input type="hidden" name="companyMembers" id="companyMembers" />



    @*////////////////////////////STEP 3 QUERY STARTS HERE///////////////////////////////////////////*@
    <br />


    @if (ViewBag.Queries != null)
    {
<div class="card">
    <div class="card-header">
        <label class="mt-3"><h4>Queries</h4></label>
        <span style="flex: 1 1 auto"></span>
    </div>
    <div class="card-body">

        <div class="tab-pane" id="updates">
            <div class="table-responsive">
                <table class="table  table-mb table-hover" style="color:#0C2A46;">
                    <thead mt-5 mb-5 style="color:#0C2A46;">
                        <tr>
                            <th style="color:#0C2A46">Date</th>
                            <th style="color:#0C2A46">Comment</th>
                            <th style="color:#0C2A46">Status</th>
                            <th style="color:#0C2A46">Action</th>
                        </tr>
                    </thead>

                    @foreach (var queries in ViewBag.Queries)
                    {
                        if (queries.tableName == "Step3")
                        {@*//step 2 Query below*@
                                                <tbody>
                                                <td>@queries.dateCreated</td>
                                                <td>@queries.comment</td>
                                                <td>@queries.status</td>
                                                <td><a class="btn btn-info" color="white">Resolve Query</a></td>
                                                </tbody>}
                                        }

                </table>
            </div>
        </div>
    </div>
</div> }
else
{
<div>no queries</div>} @*show nothing*@
@*//////////////////////////QUERIS END HERE//////////////////////*@


@*//////////////////////////END OF STEP 3//////////////////////*@


</div>




<div id="step-4" class="tab-pane" role="tabpanel" aria-labelledby="step-4">
    <div class="card">
        <div class="card-body">

            <input type="hidden" name="billercode" value="@ViewBag.billercode" />
            <input type="hidden" name="billercode" value="@ViewBag.billercode" />
            <input type="hidden" id="objectivesss" name="otherObjectives" />
            <input type="hidden" name="billercode" value="@ViewBag.billercode" />



            <div class="row">
                <div class="col-md-6">
                    <label class="form-group">Liability clause</label>
                    <div class="input-group form-group">
                        "@if (ViewBag.CompanyApplication.memo != null)
                        {
            <input type="text" class="form-control" id="liabilityClause" value="@ViewBag.CompanyApplication.memo.LiabilityClause" name="liab" step="3">}
        else
        {
<input type="text" class="form-control" id="liabilityClause" placeholder="Entity name" value="" readonly>}
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-group">Share clause</label>
                    <div class="input-group form-group">
                        @if (ViewBag.CompanyApplication.memo != null)
                        {
            <input type="text" class="form-control" id="shareClause" value="@ViewBag.CompanyApplication.memo.ShareClause" name="shareClo">}
        else
        {
<input type="text" class="form-control" id="shareClause" placeholder="Entity name" value="" readonly>}
                    </div>
                </div>
            </div>
            <div class="mt-3">
                <label>Objectives</label>
                <table class="table  table-mb table-hover" style="color:#0C2A46;">
                    <thead mt-5 mb-5 style="color:#0C2A46;">
                        <tr>
                            <th style="color:#0C2A46">#</th>
                            <th style="color:#0C2A46">Object</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.CompanyApplication.memo != null)
                        {
            @foreach (var objective in ViewBag.CompanyApplication.memo.objects)
            {
<tr>
    <td>@objective.Letter</td>
    <td>@objective.Value</td>
</tr>} }
        else
        {
<tr>
    <td></td>
    <td></td>
</tr>}

                    </tbody>
                </table>
            </div>
        </div>
    </div>



    @*////////////////////////////STEP 4 QUERY STARTS HERE///////////////////////////////////////////*@
    <br />


    @if (ViewBag.Queries != null)
    {
<div class="card">
    <div class="card-header">
        <label class="mt-3"><h4>Queries</h4></label>
        <span style="flex: 1 1 auto"></span>
    </div>
    <div class="card-body">

        <div class="tab-pane" id="updates">
            <div class="table-responsive">
                <table class="table  table-mb table-hover" style="color:#0C2A46;">
                    <thead mt-5 mb-5 style="color:#0C2A46;">
                        <tr>
                            <th style="color:#0C2A46">Date</th>
                            <th style="color:#0C2A46">Comment</th>
                            <th style="color:#0C2A46">Status</th>
                            <th style="color:#0C2A46">Action</th>
                        </tr>
                    </thead>

                    @foreach (var queries in ViewBag.Queries)
                    {
                        if (queries.tableName == "Step4")
                        {@*//step 2 Query below*@
                                                <tbody>
                                                <td>@queries.dateCreated</td>
                                                <td>@queries.comment</td>
                                                <td>@queries.status</td>
                                                <td><a class="btn btn-info" color="white">Resolve Query</a></td>
                                                </tbody>}
                                        }

                </table>
            </div>
        </div>
    </div>
</div> }
else
{
<div>no queries</div>} @*show nothing*@
@*//////////////////////////QUERIS END HERE//////////////////////*@


@*//////////////////////////END OF STEP 4//////////////////////*@

</div>





<div id="step-5" class="tab-pane" role="tabpanel" aria-labelledby="step-4">
    <div class="card">
        <div class="card-body">


            <div class="radio radio-primary form-group">
                <input type="hidden" id="tableB" value="Yes" name="articles">
                @*<label>Table B: Model Articles for Private Companies Limited by Shares</label>*@
            </div>

            <div class="radio radio-primary form-group">
                <input type="hidden" id="tableC" value="Yes" name="articles">
                @*<label>Table C: Model Articles for Private Companies Limited by Guarantee</label>*@
            </div>
            @if (ViewBag.CompanyApplication.articles != null)
            {
@foreach (var article in ViewBag.CompanyApplication.articles)
{
<div class="row">
    <div class="col-md-6">
        <div class="form-group">
            <div class="form-group">
                <label>Articles of association</label>
                <input type="text" value="@article.articles_type" class="form-control" id="articles" readonly>
            </div>
        </div>
    </div>
</div>
                    <div class="form-group">
                        <textarea type="text" class="form-control" id="ammendedArticles" value="@article.articles"></textarea>
                        <label>Provisions of non applicable or amended articles</label>
                    </div>} }
else
{
<div class="row">
    <div class="col-md-6">
        <div class="form-group">
            <div class="form-group">
                <label>Articles of association</label>
                <input type="text" value="" class="form-control" id="articles" readonly>
            </div>
        </div>
    </div>
</div>
                <div class="form-group">
                    <textarea type="text" class="form-control" id="ammendedArticles" value="" readonly></textarea>
                    <label>Provisions of non applicable or amended articles</label>
                </div>}
        </div>
    </div>
    <div class="form-group fa-pull-right mt-5">
        <button type="button" id="submitArticles" onclick="submitArticles()" class="btn btn-primary btn-sm" style="display:none">
            Save application
        </button>
    </div>




    @*////////////////////////////STEP 5 QUERY STARTS HERE///////////////////////////////////////////*@
    <br />


    @if (ViewBag.Queries != null)
    {
<div class="card">
    <div class="card-header">
        <label class="mt-3"><h4>Queries</h4></label>
        <span style="flex: 1 1 auto"></span>
    </div>
    <div class="card-body">

        <div class="tab-pane" id="updates">
            <div class="table-responsive">
                <table class="table  table-mb table-hover" style="color:#0C2A46;">
                    <thead mt-5 mb-5 style="color:#0C2A46;">
                        <tr>
                            <th style="color:#0C2A46">Date</th>
                            <th style="color:#0C2A46">Comment</th>
                            <th style="color:#0C2A46">Status</th>
                            <th style="color:#0C2A46">Action</th>
                        </tr>
                    </thead>

                    @foreach (var queries in ViewBag.Queries)
                    {
                        if (queries.tableName == "Step5")
                        {@*//step 2 Query below*@
                                                <tbody>
                                                <td>@queries.dateCreated</td>
                                                <td>@queries.comment</td>
                                                <td>@queries.status</td>
                                                <td><a class="btn btn-info" color="white">Resolve Query</a></td>
                                                </tbody>}
                                        }

                </table>
            </div>
        </div>
    </div>
</div> }
else
{
<div>no queries</div>} @*show nothing*@
@*//////////////////////////QUERIS END HERE//////////////////////*@


@*//////////////////////////END OF STEP 5//////////////////////*@


</div>
        </div>
            </div>
</div>



<script type="text/javascript">
    $(document).ready(function () {

      
        // Step show event
        $("#smartwizard").on("showStep", function (e, anchorObject, stepNumber, stepDirection, stepPosition) {
            $("#prev-btn").removeClass('disabled');
            $("#next-btn").removeClass('disabled');
            if (stepPosition === 'first') {
                $("#prev-btn").addClass('disabled');
            } else if (stepPosition === 'last') {
                $("#next-btn").addClass('disabled');
                btnFinish.removeClass('disabled');
            } else {
                $("#prev-btn").removeClass('disabled');
                $("#next-btn").removeClass('disabled');
                btnFinish.addClass('disabled');
            }
        });

        $("#smartwizard").on("leaveStep", function (e, anchorObject, stepNumber, stepDirection, stepPosition) {
            if (stepNumber === 1 && stepDirection === 'forward') {

            } else if (stepNumber === 2 && stepDirection === 'forward') {

            } else if (stepNumber === 3 && stepDirection === 'forward') {

            }
        });

        // Smart Wizard
        $('#smartwizard').smartWizard({
            theme: 'arrows',
            selected: 0,
            transition: {
                animation: 'fade', // Effect on navigation, none/fade/slide-horizontal/slide-vertical/slide-swing
            },
            toolbarSettings: {
                toolbarPosition: 'bottom', // both bottom
            }
        });

        // External Button Events
        $("#reset-btn").on("click", function () {
            // Reset wizard
            $('#smartwizard').smartWizard("reset");
            return true;
        });

        $("#prev-btn").on("click", function () {
            // Navigate previous
            $('#smartwizard').smartWizard("prev");
            return true;
        });

        $("#next-btn").on("click", function () {
            // Navigate next
            $('#smartwizard').smartWizard("next");
            return true;
        });

    });

    var selectedCheck;
    var applicationId;

    function SubmitQueryOnOffice() {
        let str = document.getElementById('query').value;
        if (!str || str.trim().length === 0) {
            alert('You must pass a comment');
        } else {
            $.ajax({
                type: "POST",
                url: "/Examination/AddressHasQuery",
                data: {
                    ApplicationRef: document.getElementById('companyAppRef').value,
                    HasQuery: document.getElementById('officeHasQuery').checked,
                    Comment: document.getElementById('query').value
                },
                success: function (data) {
                    alert('success');
                },
                error: function () {
                    alert("error here");
                },
                completed: function () {
                }
            });
        }
    }

    function approvePvtApplication() {
        $.ajax({
            type: 'POST',
            url: '/' + document.getElementById('applicationId').value + '/Approve',
            success: function (data) {
                alert('Application Approved');
                window.location = '/Home/Dashboard'
            },
            error: function (err) {
                alert("Error");
            },
        });
    }
</script>
